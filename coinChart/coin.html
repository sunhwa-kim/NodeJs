<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>
  <meta charset="utf-8">
  <title></title>
</head>

<body>
  <span id="spreadInfo"></span><br>
  <span id="showGraph"></span>
  <div id="chart_div"></div>
  <input type="button" name="" value="그래프" id="graphBtn">
  <input type="button" name="" value="엑셀 다운받기" id="reqHtml"></br>
</body>
<script src="http://code.jquery.com/jquery-latest.min.js"></script>
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script type="text/javascript">
  $.ajax({
    url: `/reqInfo`,
    type: 'get',
    success: function(res) {
      // var bitName =''
      // var upbit = ''
      // var upbitFluctuation = ''
      // var bitfinex = ''
      // var bitfinexFluctuation = ''
      reqParam = {};
      res_check = false;
      var totalAdd = [];
      for (var i = 0; i < res.length; i++) {
        // console.log(i);
        $('#spreadInfo').append(res[i] + '&nbsp;')
        if (res[i] !=" "){
          res_check = true;
          data = []
          data = res[i].slice(0,-2).split('(');
          data[0] = data[0].replace(/,/gi,"")
          if (i==1){
            reqParam.upbit = Number(data[0]);
            reqParam.upbitFluctuation = Number(data[1].slice(1));
          }
          else if(i==2){
            reqParam.bitfinex = Number(data[0]);
            reqParam.bitfinexFluctuation = Number(data[1].slice(1));
          }
          else{
            reqParam.coinName = res[i].trim();
          }
        }
    }
    if (res_check){
      $.ajax({
        url:'/insertCoin',
        type:'post',
        data:{
          param : JSON.stringify(reqParam)
        },success:function(res){
          alert("현재 데이터 저장 됐습니다.");
        }
      });
    }
  }});

        var dailyAverage = [];
  $("#graphBtn").click(function() {
        dailyAverage = [];
        for (var i = 0; i < 5; i++) {
          var selectBoxDay = $(`select[name=score${i}]`);
          var avg = 0;

          for (var j = 0; j < selectBoxDay.length; j++) {

            avg += Number(selectBoxDay[j].value);
            console.log(avg);
          }
          avg /= selectBoxDay.length;
          dailyAverage.push(avg);
          console.log(dailyAverage);
        }


            var arrForCahrt = [];
            for (var i=0; i< dailyAverage.length; i++) {
              arrForCahrt.push([dayArr[i], dailyAverage[i]])
            }

            google.charts.load('current', {packages: ['corechart', 'line']});
            google.charts.setOnLoadCallback(drawBasic);
            function drawBasic() {

                  var data = new google.visualization.DataTable();
                  data.addColumn('string', '요일');
                  data.addColumn('number', '만족도');

                  data.addRows( arrForCahrt );

                  var options = {
                    hAxis: {
                      title: '요일'
                    },
                    vAxis: {
                      title: '만족도'
                    }
                  };

                  var chart = new google.visualization.LineChart(document.getElementById('chart_div'));

                  chart.draw(data, options);
                }




      });


</script>

</html>
